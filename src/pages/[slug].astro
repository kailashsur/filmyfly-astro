---
export const prerender = true;

import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import MovieCard from '../components/MovieCard.astro';
import { getMovieBySlug, getMovies, getPublicSettings } from '../lib/api';
import { generateMovieSEO } from '../lib/seo';

export async function getStaticPaths() {
  const moviesData = await getMovies(1, 1000);

  if (!moviesData?.success || !moviesData?.data) {
    return [];
  }

  return moviesData.data.map(movie => ({
    params: { slug: movie.slug }
  }));
}

const { slug } = Astro.params;

let movieData;
let settingsData;

try {
  movieData = await getMovieBySlug(slug!);
  settingsData = await getPublicSettings();
} catch (err) {
  return new Response(null, { status: 404 });
}

if (!movieData?.success || !movieData?.data) {
  return new Response(null, { status: 404 });
}
---
